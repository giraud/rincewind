platform:
  - x86

environment:
  FORK_USER: ocaml
  FORK_BRANCH: master
  CYG_ROOT: C:\cygwin64
  PACKAGE: "rincewind"
  matrix:
    - OPAM_SWITCH: 4.02.3+mingw64c
      OCAML_VERSION: 4.02

init:
  - "echo System architecture: %PLATFORM%"

install:
  - ps: iex ((new-object net.webclient).DownloadString("https://raw.githubusercontent.com/$env:FORK_USER/ocaml-ci-scripts/$env:FORK_BRANCH/appveyor-install.ps1"))

build_script:
  - call %CYG_ROOT%\bin\bash.exe -l %APPVEYOR_BUILD_FOLDER%\appveyor-opam.sh
  - call %CYG_ROOT%\bin\bash.exe -lc "cd c:/projects/rincewind && eval `opam config env` && opam install jbuilder && jbuilder build rincewind.exe"

after_build:
  - cmd: dir
  - cmd: mkdir _build\final
  - cmd: copy _build\default\rincewind.exe _build\final\rincewind-win%OCAML_VERSION%-0.2.exe

artifacts:
  - path: _build\final\*.exe

deploy:
- provider: BinTray
  username: giraud
  api_key:
    secure: itdLWIxgaezQg/X8pwrHpl+2dxRCZvvqkTaqYMv8j1vX59m+cGrdCVHLmoWdbAGILL8zopVlqGLeOpFmrY1idBkVQHZ6z67kwNisHoulIDYX3bsBg/lF7Eo9uCCZEG3hKtPPXDx/BWvcbPdm7PQNkH/wRTFBcs7mpegspI1bD/76BKlbEkKpK/VKdgd8EMlnaiNpFHWeCuSa5hURxbkaPxjxgwh6gKI7/4RxfRQ4wKGe3ZIjaSpoUBTWB4Bgcz6GcvlJvBEjsPnWRPbeFd8C+EosVBx61UiqkN9Qq7UxdTN/yBzV+60GXFwwGoyd84RbZReBG14/3tPZUZpAGZj+rArxi78rwy9OBLVpS/N77gRh5wO9hGXeqJ6n7Fs4Mh7dLuCpwguFBL2F6VuJYOLVKKn6R3l2QyIRtnGw5+hjxaqTBLjC1d/mr+9JpJKX5AJ33HWSnOqG383dtkHMweYqjB6WezDq3e0RSNSYEAhyXBzo3lw4TSnrGsA5AE4OeZCORZHLxTX+uMTZpcl2sjKZrBUytHcXlUU2UqgszBPsgEbrhALxcRQv2jUjHY0zC+6tcHSeaBsVrquuz5+FLd4nmSEQlsNDW0d2zsRn1dpeFJW8BLy6xPm9s1Uq+EbhNWwIVGspcDjETTinvl5AqioFvPtOjyT/LsGhMtRvyTKZIBo=
  subject: giraud
  repo: ocaml
  package: rincewind
  version: 0.2
  publish: true
